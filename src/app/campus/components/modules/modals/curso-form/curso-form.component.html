<form (ngSubmit)="submit.emit(curso)" #cursoForm="ngForm" class="space-y-6">
  <!-- Nombre -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      Nombre del curso <span class="text-red-500">*</span>
    </label>
    <input
      type="text"
      [(ngModel)]="curso.nombre"
      name="nombre"
      #nombre="ngModel"
      required
      minlength="3"
      placeholder="Ej: Matemáticas Básicas"
      class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"
      [disabled]="isReadOnly"
    />
    <div
      *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)"
      class="text-xs text-red-600 mt-1"
    >
      El nombre es obligatorio y debe tener al menos 3 caracteres.
    </div>
  </div>

  <!-- Abreviatura -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      Abreviatura <span class="text-red-500">*</span>
    </label>
    <input
      type="text"
      [(ngModel)]="curso.abreviatura"
      name="abreviatura"
      #abreviatura="ngModel"
      required
      maxlength="5"
      placeholder="Ej: MAT"
      class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"
      [disabled]="isReadOnly"
    />
    <div
      *ngIf="abreviatura.invalid && (abreviatura.dirty || abreviatura.touched)"
      class="text-xs text-red-600 mt-1"
    >
      La abreviatura es obligatoria (máx. 5 caracteres).
    </div>
  </div>

  <!-- Descripción -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      Descripción <span class="text-red-500">*</span>
    </label>
    <textarea
      [(ngModel)]="curso.descripcion"
      name="descripcion"
      #descripcion="ngModel"
      required
      rows="3"
      placeholder="Breve descripción del curso..."
      class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"
      [disabled]="isReadOnly"
    ></textarea>
    <div
      *ngIf="descripcion.invalid && (descripcion.dirty || descripcion.touched)"
      class="text-xs text-red-600 mt-1"
    >
      La descripción es obligatoria.
    </div>
  </div>

  <!-- Competencias (solo edición) -->
  <div *ngIf="!isReadOnly">
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      Competencias <span class="text-red-500">*</span>
    </label>
    <p class="text-xs text-gray-500 mb-2">
      Debe agregar al menos una competencia
    </p>

    <div
      *ngFor="let comp of curso.competencias; let i = index"
      class="flex gap-2 mt-2"
    >
      <input
        type="text"
        [(ngModel)]="curso.competencias[i].nombre"
        [name]="'competencia-' + i"
        #compInput="ngModel"
        required
        placeholder="Ej: Resuelve problemas matemáticos"
        class="flex-1 px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      />
      <button
        type="button"
        (click)="removeCompetencia(i)"
        class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-md border border-red-200 transition"
      >
        <fa-icon [icon]="['fas', 'trash']"></fa-icon>
      </button>
    </div>

    <button
      type="button"
      (click)="addCompetencia()"
      class="mt-3 text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-2"
    >
      <fa-icon [icon]="['fas', 'plus-circle']"></fa-icon>
      Agregar competencia
    </button>
  </div>

  <!-- Competencias en modo lectura -->
  <div *ngIf="isReadOnly && curso.competencias.length">
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
      >Competencias</label
    >
    <ul class="mt-2 space-y-2 text-sm text-gray-600 dark:text-gray-400">
      <li
        *ngFor="let comp of curso.competencias"
        class="flex items-center gap-2"
      >
        <fa-icon
          [icon]="['fas', 'check-circle']"
          class="text-green-500"
        ></fa-icon>
        {{ comp.nombre }}
      </li>
    </ul>
  </div>

  <!-- BOTONES -->
  <div class="mt-8 sm:flex sm:items-center sm:-mx-2">
    <button
      type="button"
      (click)="cancel.emit()"
      class="w-full px-4 py-2.5 text-sm font-medium tracking-wide text-gray-700 capitalize transition-colors duration-300 transform border border-gray-200 rounded-md sm:w-1/2 sm:mx-2 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-800 hover:bg-gray-100 focus:outline-none focus:ring focus:ring-gray-300 focus:ring-opacity-40"
    >
      Cancelar
    </button>

    <button
      type="submit"
      [disabled]="cursoForm.invalid || isReadOnly || !hasValidCompetencias()"
      (click)="onSubmit($event)"
      class="w-full px-4 py-2.5 mt-3 text-sm font-medium tracking-wide text-white capitalize transition-colors duration-300 transform bg-blue-600 rounded-md sm:mt-0 sm:w-1/2 sm:mx-2 hover:bg-blue-500 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 disabled:opacity-60 disabled:cursor-not-allowed"
    >
      {{ curso.idCurso ? "Actualizar" : "Guardar" }}
    </button>
  </div>
</form>
