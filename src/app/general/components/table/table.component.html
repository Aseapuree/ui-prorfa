<div class="mt-4 flex items-center">
  <label for="itemsPerPage" class="text-sm text-gray-500 dark:text-gray-400 mr-2">
    Mostrar:
  </label>
  <select
    id="itemsPerPage"
    [(ngModel)]="itemsPerPage"
    (ngModelChange)="onItemsPerPageChange($event)"
    class="py-1.5 px-2 text-sm text-gray-700 bg-white border border-gray-200 rounded-lg dark:bg-gray-900 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 dark:focus:border-blue-300 focus:outline-none"
  >
    <option *ngFor="let option of pageSizeOptions" [value]="option">
      {{ option }}
    </option>
  </select>
  <span class="ml-2 text-sm text-gray-500 dark:text-gray-400">
    registros por página
  </span>
</div>

<div class="flex flex-col">
  <div class="table-container overflow-x-auto shadow-sm">
    <div class="inline-block min-w-full py-2 align-middle">
      <div
        class="overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg"
      >
        <table
          class="min-w-full table-auto divide-y divide-gray-200 dark:divide-gray-700"
        >
          <!-- Sección de encabezado de la tabla -->
          <thead class="bg-table-header-bg">
            <tr>
              <!-- Encabezados de la tabla -->
              <th
                *ngFor="let column of columns"
                class="py-3.5 px-4 md:px-2 text-sm font-normal text-center text-table-header-text max-w-[{{
                  column.maxWidth
                }}px] relative"
                [ngClass]="{
                  'cursor-pointer': column.sortable
                }"
                (click)="column.sortable && onSort(column.field)"
              >
                {{ column.header }}
              </th>
              <!-- Columna de acciones -->
              <th
                *ngIf="enableActions && actions.length > 0"
                class="py-3.5 px-4 md:px-2 text-sm font-normal text-center text-table-header-text max-w-[100px] relative"
              >
                ACCIONES
              </th>
            </tr>
          </thead>
          <!-- Sección de datos de la tabla -->
          <tbody
            class="bg-table-row-bg divide-y divide-gray-200 dark:divide-gray-700 dark:bg-table-row-bg"
          >
            <tr *ngFor="let item of data">
              <!-- Datos de cada fila -->
              <td
                *ngFor="let column of columns"
                class="px-4 md:px-2 py-4 text-sm text-table-row-text max-w-[{{
                  column.maxWidth
                }}px] truncate"
              >
                <ng-container *ngIf="column.preview; else existingContent">
                  <div class="relative group cursor-default">
                    <span class="block truncate pr-8">
                      <ng-container
                        *ngIf="column.transform; else simpleTextPreview"
                      >
                        {{ column.transform(item[column.field]) }}
                      </ng-container>
                      <ng-template #simpleTextPreview>
                        {{ truncateText(item[column.field]) }}
                      </ng-template>
                    </span>
                    <fa-icon
                      [icon]="['fas', 'eye']"
                      class="absolute right-1 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-blue-500 cursor-pointer h-4 w-4"
                      (click)="
                        onPreviewClick(item, column.field);
                        $event.stopPropagation()
                      "
                    ></fa-icon>
                  </div>
                </ng-container>
                <ng-template #existingContent>
                  <ng-container *ngIf="column.transform; else simpleText">
                    <ng-container
                      *ngIf="
                        column.field === 'competencias';
                        else transformedText
                      "
                    >
                      <span
                        class="cursor-pointer hover:text-blue-600"
                        (click)="showCompetenciasModal(item)"
                        [innerHTML]="
                          column.transform(item[column.field]) | safeHtml
                        "
                      ></span>
                    </ng-container>
                    <ng-template #transformedText>
                      {{ column.transform(item[column.field]) }}
                    </ng-template>
                  </ng-container>
                  <ng-template #simpleText>
                    {{ item[column.field] }}
                  </ng-template>
                </ng-template>
              </td>
              <!-- Columna de acciones -->
              <td
                *ngIf="enableActions && actions.length > 0"
                class="px-4 md:px-2 py-4 text-sm max-w-[100px]"
              >
                <div class="flex items-center gap-x-6 md:gap-x-3">
                  <ng-container *ngFor="let action of actions">
                    <!-- CAMBIO: Se añadió *ngIf para controlar la visibilidad de la acción. -->
                    <app-tooltip
                      [tooltipText]="action.tooltip"
                      *ngIf="!action.visible || action.visible(item)"
                    >
                      <button
                        (click)="action.action(item)"
                        class="text-table-action-icon transition-colors duration-200"
                        [ngClass]="
                          action.hoverColor
                            ? 'hover:text-' + action.hoverColor
                            : 'hover:text-primary-hover'
                        "
                      >
                        <fa-icon [icon]="action.icon" class="h-8 w-8"></fa-icon>
                      </button>
                    </app-tooltip>
                  </ng-container>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
