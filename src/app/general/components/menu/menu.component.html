<nav [class.closed]="menuCerrado" class="h-full w-64 text-white p-4 flex flex-col shadow-lg transition-all duration-300 bg-[--primary-dark]">
  <!-- Botón para retraer/expandir -->
  <button class="toggle-menu" (click)="toggleMenu()">☰</button>

  <div [ngClass]="{ 'hidden': menuCerrado, 'flex': !menuCerrado }" class="flex flex-col items-center justify-center mb-6">
    <!-- Ícono del usuario y nombre -->
    <div *ngIf="!imagenValida" class="w-20 h-20 rounded-full overflow-hidden bg-gray-700 flex items-center justify-center text-white text-2xl">
      {{ obtenerIniciales() }}
    </div>
    <img *ngIf="imagenValida" [src]="perfilUrl" alt="Foto de perfil" class="w-20 h-20 rounded-full object-cover border-2 border-white">
    <p class="text-lg font-bold text-white mt-2" *ngIf="!menuCerrado">
      {{ nombreUsuario }} {{ apellidoPaterno }} {{ apellidoMaterno }}
    </p>
    <p class="text-sm text-gray-300" *ngIf="!menuCerrado">{{ nombreRol || 'Sin Rol' }}</p>
  </div>

  <!-- Menús y submenús -->
  <ul class="space-y-2">
    <!-- Botón de Inicio -->
    <li class="relative"
        (mouseenter)="menuCerrado && showExpanded('inicio')"
        (mouseleave)="menuCerrado && hideExpanded()">
      <button class="menu-btn flex items-center gap-3 w-full" 
              [class.expanded]="menuCerrado && activeTooltipId === 'inicio'"
              (click)="principal()">
        <fa-icon [icon]="faHome" class="text-lg"></fa-icon>
        <span class="flex-grow text-left">Inicio</span>
      </button>
    </li>
    <li *ngFor="let menu of menuJerarquico; trackBy: trackById" class="relative">
      <div (mouseenter)="menuCerrado && showExpanded(menu.idMenu)"
           (mouseleave)="menuCerrado && hideExpanded()">
        <button class="menu-btn flex items-center gap-3 w-full" 
                [class.expanded]="menuCerrado && activeTooltipId === menu.idMenu"
                (click)="menu.submenus?.length ? toggleSubMenu(menu.idMenu || '') : navigate(menu)">
          <fa-icon *ngIf="menu.icono" [icon]="menu.icono" class="text-lg"></fa-icon> 
          <span class="flex-grow text-left">{{ menu.menu_descripcion }}</span>
          <span *ngIf="menu.submenus?.length && !menuCerrado" class="submenu-icon">
            {{ subMenuOpen[menu.idMenu || ''] ? '▼' : '►' }}
          </span>
        </button>
        <div *ngIf="menuCerrado && activeTooltipId === menu.idMenu && menu.idMenu && menu.submenus && menu.submenus.length > 0" 
             class="submenu-container"
             (click)="$event.stopPropagation()">
          {{ logSubmenuRender(menu.idMenu, menu.submenus.length) }}
          <div class="menu-label">
            <fa-icon *ngIf="menu.icono" [icon]="menu.icono" class="text-lg"></fa-icon>
            <span>{{ menu.menu_descripcion }}</span>
          </div>
          <ul class="submenu-list">
            <li *ngFor="let submenu of menu.submenus; trackBy: trackById" class="submenu-item">
              <button class="submenu-btn" (click)="navigate(submenu)">
                <fa-icon *ngIf="submenu.icono" [icon]="submenu.icono" class="text-sm"></fa-icon>
                <span>{{ submenu.menu_descripcion }}</span>
              </button>
            </li>
          </ul>
        </div>
      </div>

      <!-- Submenús desplegables -->
      <ul *ngIf="menu.submenus?.length && subMenuOpen[menu.idMenu || ''] && !menuCerrado" class="submenu pl-6">
        <li *ngFor="let submenu of menu.submenus; trackBy: trackById" class="relative">
          <button class="submenu-btn flex items-center gap-3 w-full" 
                  (click)="navigate(submenu)">
            <fa-icon *ngIf="submenu.icono" [icon]="submenu.icono" class="text-lg"></fa-icon> 
            <span *ngIf="!menuCerrado" class="flex-grow text-left">{{ submenu.menu_descripcion }}</span>
          </button>
        </li>
      </ul>
    </li>

    <!-- Botón de Perfil -->
    <li class="relative"
        (mouseenter)="menuCerrado && showExpanded('perfil')"
        (mouseleave)="menuCerrado && hideExpanded()">
      <button class="menu-btn flex items-center gap-3 w-full" 
              [class.expanded]="menuCerrado && activeTooltipId === 'perfil'"
              (click)="irAPerfil()">
        <fa-icon [icon]="faUserCircle" class="text-lg text-blue-400"></fa-icon>
        <span class="flex-grow text-left">Perfil</span>
      </button>
    </li>

    <!-- Botón de Cerrar Sesión -->
    <li class="relative"
        (mouseenter)="menuCerrado && showExpanded('logout')"
        (mouseleave)="menuCerrado && hideExpanded()">
      <button class="exit-btn flex items-center gap-3 w-full" 
              [class.expanded]="menuCerrado && activeTooltipId === 'logout'"
              (click)="logout()">
        <fa-icon [icon]="faSignOutAlt" class="text-lg text-white drop-shadow-md"></fa-icon>
        <span class="flex-grow text-left">Cerrar Sesión</span>
      </button>
    </li>
  </ul>
</nav>