<div class="perfil-container" *ngIf="perfilForm">
  <div class="header">
    <h4 class="perfil-title">Perfil Institucional</h4>
  </div>

  <!-- Imagen de perfil -->
  <div class="image-upload-container">
    <div class="image-wrapper">
      <img
        [src]="imagenPrevia || '../../../assets/imagenes/usuario.png'"
        alt="Imagen de perfil"
        class="perfil-img"
        (click)="triggerFileInput()"
      />
      <div class="upload-overlay">Cambiar imagen</div>
    </div>
    <input
      type="file"
      accept="image/*"
      (change)="onImageChange($event)"
      class="file-input"
      #fileInput
    />
    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>
  </div>

  <!-- Formulario -->
  <form [formGroup]="perfilForm" (ngSubmit)="guardarPerfil()">
    <!-- Campos comunes -->
    <div class="form-group">
      <label class="form-label">Nombre Completo</label>
      <input
        type="text"
        formControlName="nombreCompleto"
        class="form-input"
        [class.invalid]="perfilForm.get('nombreCompleto')?.invalid && perfilForm.get('nombreCompleto')?.touched"
      />
      <span class="error-message" *ngIf="perfilForm.get('nombreCompleto')?.hasError('required') && perfilForm.get('nombreCompleto')?.touched">
        El nombre es obligatorio.
      </span>
      <span class="error-message" *ngIf="perfilForm.get('nombreCompleto')?.hasError('minlength') && perfilForm.get('nombreCompleto')?.touched">
        El nombre debe tener al menos 2 caracteres.
      </span>
    </div>

    <div class="form-group">
      <label class="form-label">Correo Electrónico</label>
      <input
        type="email"
        formControlName="correo"
        class="form-input"
        [class.invalid]="perfilForm.get('correo')?.invalid && perfilForm.get('correo')?.touched"
      />
      <span class="error-message" *ngIf="perfilForm.get('correo')?.hasError('required') && perfilForm.get('correo')?.touched">
        El correo es obligatorio.
      </span>
      <span class="error-message" *ngIf="perfilForm.get('correo')?.hasError('email') && perfilForm.get('correo')?.touched">
        Ingresa un correo válido.
      </span>
    </div>

    <!-- Campos específicos por rol -->
    <ng-container *ngIf="selectedRole" [ngSwitch]="selectedRole">
      <!-- Alumno -->
      <ng-container *ngSwitchCase="'Alumno'">
        <div class="form-group">
          <label class="form-label">Código de Matrícula</label>
          <input type="text" formControlName="codigoMatricula" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Grado</label>
          <input type="text" formControlName="grado" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Sección</label>
          <input type="text" formControlName="seccion" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Nivel</label>
          <input type="text" formControlName="nivel" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Dirección</label>
          <input type="text" formControlName="direccion" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Apoderado</label>
          <input type="text" formControlName="apoderadoNombre" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Teléfono del Apoderado</label>
          <input type="text" formControlName="apoderadoTelefono" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Correo del Apoderado</label>
          <input type="email" formControlName="apoderadoCorreo" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Fecha de Matrícula</label>
          <input type="text" formControlName="fechaMatricula" class="form-input" readonly />
        </div>
      </ng-container>

      <!-- Profesor -->
      <ng-container *ngSwitchCase="'Profesor'">
        <div class="form-group">
          <label class="form-label">Rol</label>
          <input type="text" formControlName="rol" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Teléfono</label>
          <input type="text" formControlName="telefono" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Dirección</label>
          <input type="text" formControlName="direccion" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Asignaciones</label>
          <div class="assignment-container">
            <div class="assignment-section">
              <h5>Cursos a Cargo</h5>
              <div class="grid-container">
                <div *ngFor="let curso of cursosList" class="grid-item">{{ curso }}</div>
              </div>
            </div>
            <div class="assignment-section">
              <h5>Aulas a Cargo</h5>
              <div class="grid-container">
                <div *ngFor="let aula of aulasList" class="grid-item">{{ aula }}</div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Administrador -->
      <ng-container *ngSwitchCase="'Administrador'">
        <div class="form-group">
          <label class="form-label">Rol</label>
          <input type="text" formControlName="rol" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Resumen Institucional</label>
          <div class="stats-container">
            <div class="stat-card">
              <h5>Total Profesores</h5>
              <p>{{ perfilForm.get('totalProfesores')?.value }}</p>
            </div>
            <div class="stat-card">
              <h5>Total Cursos</h5>
              <p>{{ perfilForm.get('totalCursos')?.value }}</p>
            </div>
            <div class="stat-card">
              <h5>Total Alumnos Matriculados</h5>
              <p>{{ perfilForm.get('totalAlumnos')?.value }}</p>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Tesorero -->
      <ng-container *ngSwitchCase="'Tesorero'">
        <div class="form-group">
          <label class="form-label">Rol</label>
          <input type="text" formControlName="rol" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Teléfono</label>
          <input type="text" formControlName="telefono" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Dirección</label>
          <input type="text" formControlName="direccion" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Código de Matrícula</label>
          <input type="text" formControlName="codigoMatricula" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Código de Alumno</label>
          <input type="text" formControlName="codigoAlumno" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Total Pagos Recibidos</label>
          <input type="text" formControlName="totalPagosRecibidos" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Código de Pago</label>
          <input type="text" formControlName="codigoPago" class="form-input" readonly />
        </div>
      </ng-container>

      <!-- Desarrollador -->
      <ng-container *ngSwitchCase="'Desarrollador'">
        <div class="form-group">
          <label class="form-label">Rol</label>
          <input type="text" formControlName="rol" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Nombre del Colegio</label>
          <input type="text" formControlName="nombreColegio" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Dirección del Colegio</label>
          <input type="text" formControlName="direccionColegio" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">RUC del Colegio</label>
          <input type="text" formControlName="rucColegio" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Teléfono del Colegio</label>
          <input type="text" formControlName="telefonoColegio" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label">Correo del Colegio</label>
          <input type="email" formControlName="correoColegio" class="form-input" readonly />
        </div>
      </ng-container>

      <!-- Caso por defecto -->
      <ng-container *ngSwitchDefault>
        <div class="form-group">
          <label class="form-label">Rol</label>
          <input type="text" formControlName="rol" class="form-input" readonly />
        </div>
      </ng-container>
    </ng-container>

    <div class="form-group">
      <label class="form-label">Nueva Contraseña</label>
      <input
        type="password"
        formControlName="contrasena"
        class="form-input"
        [class.invalid]="perfilForm.get('contrasena')?.invalid && perfilForm.get('contrasena')?.touched"
      />
      <span class="error-message" *ngIf="perfilForm.get('contrasena')?.hasError('minlength') && perfilForm.get('contrasena')?.touched">
        La contraseña debe tener al menos 6 caracteres.
      </span>
    </div>

    <div class="form-actions">
      <button class="submit-button" type="submit" [disabled]="perfilForm.invalid">
        Guardar Cambios
      </button>
    </div>
  </form>
</div>