<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Matrículas Registradas</h2>

  <div class="mt-4 mb-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg shadow">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end">
      <div class="space-y-1">
        <label for="codigomatricula" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Código Matrícula</label>
        <input
          type="text"
          id="codigomatricula"
          [(ngModel)]="filters.codigomatricula"
          placeholder="Ej: M001"
          (input)="onInputChange($event, 'codigomatricula')"
          (keydown.enter)="onEnterKey($event)"
          class="py-2 px-3 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
        />
      </div>

      <div class="space-y-1">
        <label for="codigopago" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Código Pago</label>
        <input
          type="text"
          id="codigopago"
          [(ngModel)]="filters.codigopago"
          placeholder="Ej: P001"
          (input)="onInputChange($event, 'codigopago')"
          (keydown.enter)="onEnterKey($event)"
          class="py-2 px-3 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
        />
      </div>

      <div class="space-y-1">
        <label for="nivel" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nivel</label>
        <div class="relative">
          <select
            id="nivel"
            [(ngModel)]="filters.nivel"
            (change)="onNivelChange()"
            class="py-2 pl-3 pr-10 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [ngClass]="{'border-blue-500 dark:border-blue-400': filters.nivel}"
          >
            <option value="">Seleccionar Nivel</option>
            <option *ngFor="let nivel of nivelesParaFiltro" [value]="nivel">{{ nivel }}</option>
            </select>
        </div>
      </div>

      <div class="space-y-1">
        <label for="grado" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Grado</label>
        <div class="relative">
          <select
            id="grado"
            [(ngModel)]="filters.grado"
            (change)="onGradoChange()" [disabled]="!filters.nivel || gradosParaFiltro.length === 0" class="py-2 pl-3 pr-10 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
            [ngClass]="{'border-blue-500 dark:border-blue-400': filters.grado}"
          >
            <option value="">Seleccionar Grado</option>
            <option *ngFor="let grado of gradosParaFiltro" [value]="grado">{{ grado }}</option>
            </select>
        </div>
      </div>

      <div class="space-y-1">
        <label for="seccion" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Sección</label>
        <div class="relative">
          <select
            id="seccion"
            [(ngModel)]="filters.seccion"
            [disabled]="!filters.grado || seccionesParaFiltro.length === 0" class="py-2 pl-3 pr-10 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
            [ngClass]="{'border-blue-500 dark:border-blue-400': filters.seccion}"
          >
            <option value="">Seleccionar Sección</option>
            <option *ngFor="let seccionItem of seccionesParaFiltro" [value]="seccionItem.nombre">{{ seccionItem.nombre }}</option>
            </select>
        </div>
      </div>

      <div class="space-y-1">
        <label for="fechaInicio" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Fecha Inicio</label>
        <input
          type="date"
          id="fechaInicio"
          [(ngModel)]="filters.fechaInicio"
          [max]="currentDate"
          (change)="onDateChange('fechaInicio')"
          class="py-2 px-3 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
        />
      </div>

      <div class="space-y-1">
        <label for="fechaFin" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Fecha Fin</label>
        <input
          type="date"
          id="fechaFin"
          [(ngModel)]="filters.fechaFin"
          [max]="currentDate"
          [min]="filters.fechaInicio || ''" (change)="onDateChange('fechaFin')"
          class="py-2 px-3 block w-full border-gray-300 dark:border-gray-600 rounded-md text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
        />
      </div>
    </div>

    <div class="mt-4 flex flex-wrap items-center justify-between gap-4">
     <!--  <div class="flex items-center">
        <label for="itemsPerPage" class="text-sm font-medium text-gray-900 dark:text-gray-300 mr-2">Mostrar:</label>
        <select
          id="itemsPerPage"
          [(ngModel)]="pageSize"
          (ngModelChange)="onSearch()" class="py-1.5 px-2 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500"
        >
          <option *ngFor="let option of [5, 10, 15]" [value]="option">{{ option }}</option>
        </select>
        <span class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">registros por página</span>
      </div> -->

      <div class="flex flex-wrap items-center gap-2">
        <app-tooltip tooltipText="Buscar matrículas">
          <button
            (click)="onSearch()"
            class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white dark:text-gray-900 bg-blue-600 dark:bg-blue-400 border border-transparent rounded-md shadow-sm hover:bg-blue-700 dark:hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 gap-x-2"
          >
            <fa-icon [icon]="['fas', 'search']"></fa-icon>
            <span>Buscar</span>
          </button>
        </app-tooltip>
        <app-tooltip tooltipText="Limpiar filtros">
          <button
            (click)="resetFilter()"
            class="flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 gap-x-2"
          >
            <fa-icon [icon]="['fas', 'broom']"></fa-icon>
            <span>Limpiar</span>
          </button>
        </app-tooltip>

    <app-tooltip tooltipText="Exportar datos filtrados actualmente a Excel">
      <button
        (click)="exportToExcel()"
        [disabled]="matriculados.length === 0 || loading"
        class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white dark:text-gray-900 bg-green-600 dark:bg-green-400 border border-transparent rounded-md shadow-sm hover:bg-green-700 dark:hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed gap-x-2"
      >
        <fa-icon [icon]="['fas', 'file-excel']"></fa-icon>
        <span>Exportar a Excel</span>
      </button>
    </app-tooltip>
      </div>
    </div>
  </div>

  <!--<app-table
    [data]="matriculados"
    [columns]="columns"
    [actions]="actions"
    [enableActions]="true"
    (sortChange)="onSearch($event)" />

  <div *ngIf="!loading && matriculados.length === 0" class="text-center text-gray-500 dark:text-gray-400 mt-6 p-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-md">
    No se encontraron datos con los filtros aplicados.
  </div> -->

  <app-table
      *ngIf="matriculados.length > 0 || loading"
      [data]="matriculados"
      [columns]="columns"
      [enableActions]="true"
      [actions]="actions"
      (sortChange)="onSearch($event)"
    ></app-table>

  <!--<div class="mt-6 flex items-center justify-between">
    <span *ngIf="!loading && totalPages > 0" class="text-sm text-gray-600 dark:text-gray-400">Página {{ currentPage }} de {{ totalPages }}</span>
    <app-pagination
      *ngIf="!loading && totalPages > 1"
      [page]="currentPage"
      [totalPages]="totalPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
  </div>-->

  <app-pagination
      [totalPages]="totalPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>

  <app-general-loading-spinner [visible]="loading" [message]="spinnerMessage"></app-general-loading-spinner>

  <app-notification></app-notification>
</div>
