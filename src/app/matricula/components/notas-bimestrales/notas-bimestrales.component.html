<app-general-loading-spinner [visible]="isLoading" [message]="loadingMessage"></app-general-loading-spinner>
<div class="notas-container">
  <!-- Navegación -->
  <div class="nav">
    <a href="javascript:void(0)" (click)="regresar()" class="nav-item">
      <i class="fas fa-chevron-left mr-2"></i>Campus
    </a>
    <span class="nav-info">
      <i class="fas fa-graduation-cap mr-2"></i>{{ alumnoNombre }} - {{ nivel }} - Notas Bimestrales
    </span>
  </div>

  <!-- Encabezado -->
  <div class="header">
    <h1 class="text-3xl font-extrabold text-[--text-color] flex items-center justify-center animate-fade-in">
      <i class="fas fa-book-open mr-4 text-[--accent-color] text-4xl"></i>Boleta Bimestral
    </h1>
    <p class="text-[--text-color] opacity-80 text-center mt-2">Resumen de las notas por curso y bimestre</p>
  </div>

  <!-- Filtros -->
  <div class="filters flex flex-wrap gap-4 justify-center items-center mb-6">
    <div class="filter-group flex items-center">
      <label for="bimestreFilter" class="filter-label mr-2"><i class="fas fa-calendar-alt mr-1"></i></label>
      <select id="bimestreFilter" [(ngModel)]="filterBimestre" (change)="aplicarFiltros()" class="filter-select">
        <option value="">Todos los bimestres</option>
        <option *ngFor="let bimestre of availableBimestres" [value]="bimestre">{{ bimestre }}</option>
      </select>
    </div>
    <div class="filter-group flex items-center">
      <label for="notaMinFilter" class="filter-label mr-2"><i class="fas fa-sort-numeric-up mr-1"></i></label>
      <select id="notaMinFilter" [(ngModel)]="filterNotaType" (change)="aplicarFiltros()" class="filter-select">
        <option value="">Todas las notas</option>
        <option value="aprobatoria">Nota Aprobatoria</option>
        <option value="desaprobatoria">Nota Desaprobatoria</option>
      </select>
    </div>
  </div>

  <!-- Mensaje si no hay notas -->
  <div class="no-data" *ngIf="cursosNotas.length === 0 && isDataLoaded">
    <p class="text-[--text-color] opacity-70">No hay notas bimestrales registradas para este alumno.</p>
  </div>

  <!-- Tabla de notas bimestrales -->
  <div class="table-container" *ngIf="cursosNotas.length > 0">
    <table class="notas-table w-full">
      <thead>
        <tr>
          <th class="p-3"><i class="fas fa-bars"></i></th>
          <th class="p-3">Curso</th>
          <th class="p-3">Bimestre 1</th>
          <th class="p-3">Bimestre 2</th>
          <th class="p-3">Bimestre 3</th>
          <th class="p-3">Bimestre 4</th>
          <th class="p-3">Promedio General</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let cursoData of cursosNotas; let idx = index">
          <tr class="summary-row cursor-pointer hover:bg-[--primary-hover] transition-colors" (click)="toggleRow(cursoData.curso + '-' + idx)">
            <td class="p-3 text-center"><i class="fas" [ngClass]="expandedRows.has(cursoData.curso + '-' + idx) ? 'fa-chevron-down' : 'fa-chevron-right'"></i></td>
            <td class="p-3">{{ cursoData.curso }}</td>
            <td class="p-3 text-center">{{ cursoData.bimestres[0]?.promedio ?? 'N/A' }}</td>
            <td class="p-3 text-center">{{ cursoData.bimestres[1]?.promedio ?? 'N/A' }}</td>
            <td class="p-3 text-center">{{ cursoData.bimestres[2]?.promedio ?? 'N/A' }}</td>
            <td class="p-3 text-center">{{ cursoData.bimestres[3]?.promedio ?? 'N/A' }}</td>
            <td class="p-3 text-center">{{ cursoData.promedioGeneral }}</td>
          </tr>
          <tr *ngIf="expandedRows.has(cursoData.curso + '-' + idx)" class="details-row">
            <td colspan="7">
              <div class="details-container">
                <table class="details-table w-full">
                  <thead>
                    <tr>
                      <th class="p-2"><i class="fas fa-calendar"></i> Bimestre</th>
                      <th class="p-2"><i class="fas fa-star"></i> Nota</th>
                      <th class="p-2"><i class="fas fa-comment"></i> Comentario</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let bimestre of cursoData.bimestres" class="hover:bg-[--secondary-hover] transition-colors">
                      <td class="p-2 text-center">{{ bimestre.bimestre }}</td>
                      <td class="p-2 text-center">{{ bimestre.promedio ?? 'N/A' }}</td>
                      <td class="p-2">{{ bimestre.comentario || 'Sin comentario' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Botones de acción -->
  <div class="actions mt-6 text-center flex justify-center gap-4">
    <button class="btn-regresar flex items-center justify-center" (click)="regresar()">
      <i class="fas fa-arrow-left mr-2"></i>Regresar
    </button>
    <button class="btn-imprimir flex items-center justify-center" (click)="imprimirBoleta()">
      <i class="fas fa-print mr-2"></i>Imprimir Boleta
    </button>
  </div>
  <app-pagination></app-pagination>
</div>